trait Speaker {
    func speak(&self) string;
}

class Animal2 : Speaker {
    func speak(self) string {
        return "~ Animal2.speak() ~";
    }
}

class Frog : Animal2 {
    #[override]
    func speak(self) string {
        return "Croack";
    }
}

class Lion : Animal2 { }

func speaker(s: Speaker) string {
    return s.speak();
}

test "traits: calling class method" {
    @assert(speaker(Animal2()) == "~ Animal2.speak() ~");
}

test "traits: calling inherited method" {
    @assert(speaker(Lion()) == "~ Animal2.speak() ~");
}

test "traits: calling overrided method" {
    @assert(speaker(Frog()) == "Croack");
}

trait Reader {
    func read(&self) uint8;
}

trait Writer {
    func write(&self, b: uint8) bool;
}

trait ReaderWriter : Reader, Writer {
    func write_and_read(&self, b: uint8) uint8;
}

struct SomeStream : ReaderWriter {
    func read(&self) uint8 {
        return b'A';
    }

    func write(&self, b: uint8) bool { return true; }

    func write_and_read(&self, b: uint8) uint8 {
        _ = self.write(b);
        return self.read();
    }
}

func writer(w: Writer) bool {
    return w.write(b'A');
}

func reader(r: Reader) uint8 {
    return r.read();
}

func reader_writer(rw: ReaderWriter) uint8 {
    return rw.write_and_read(b'A');
}

test "traits: inheritance" {
    ss := SomeStream();
    @assert(writer(ss));
    @assert(reader(ss) == b'A');
    @assert(reader_writer(ss) == b'A');
}
